#!/usr/bin/env python3

import sys
import argparse
import json
import logging
import pathlib


def write_isle_tags(data, output):
    self_path = pathlib.Path(__file__)
    print(f";; GENERATED BY `{self_path.stem}`. DO NOT EDIT!!!", file=output);
    for (term, tags) in data.items():
        print("", file=output)
        print(f"(attr {term}", file=output)
        for tag in tags:
            print(f"    (tag {tag})", file=output)
        print(")", file=output)


def main(args):
    # Options.
    parser = argparse.ArgumentParser(description='Generate ISLE tags for CLIF terms')
    parser.add_argument('--data', required=True, type=argparse.FileType('r'), help="clif tags JSON file")
    parser.add_argument('--output', type=argparse.FileType('w'), default=sys.stdout)
    parser.add_argument('--log-level', default="info")
    opts = parser.parse_args(args)
    logging.basicConfig(level=opts.log_level.upper())

    # Read CLIF tags.
    data = json.load(opts.data)

    # Write ISLE.
    write_isle_tags(data, opts.output)


if __name__ == "__main__":
    main(sys.argv[1:])
